# Client-Server Model 客户端-服务端模式

### 什么是服务端（服务器）？

服务器是游戏的一个实例，所有其他玩家想要一起玩时都可以连接到该实例。服务器通常管理游戏的各个方面，例如记分，并将发数据传回客户端。

### 什么是客户端？

客户端是连接到服务器的游戏实例，通常从不同的计算机连接到服务器。客户端可以通过本地网络或在线连接。

### 什么是模式？

模式指的是通过数据传输和数据渲染实现多人联机的逻辑。其设计目的是让玩家之间相互感觉到置身于同一个世界场景。

目前主流的有两套模式（实现逻辑），一个是客户端/服务端（CS）模式，一个是客户端/客户端（CC）模式。

### 服务器server与主机host有什么区别？

服务器分为专用服务器`Dedicated server`和主机服务器`Host server`。

**专用服务器**是一个仅仅作为服务器运行的游戏实例。

当没有专用服务器时，其中一个客户端也可以扮演服务器的角色。这个客户端就成了**主机服务器**`Host server`，简称**主机**`host`。即，**主机**指的就是**主机服务器**，它创建游戏的单个实例，既充当服务器又充当客户端。这个客户端也称为**本地客户端**，即在服务器本机上运行的客户端。其他远程连接到服务器的客户端称为远程客户端。

### 主机是如何实现的？

主机是游戏的单个实例，同时充当服务器和客户端。主机使用一种特殊的内部客户端进行本地客户端通信，而其他客户端时远程客户端。本地客户端通过直接函数调用和消息队列与服务器通信，因为他们在同一个进程中。它实际上与服务器共享场景。远程客户端通过常规网络连接与服务器通信。`Mirror`会自动处理这一进程。

### 客户端与服务器端是否需要分别开发？

不用。多人系统的目标之一就是让服务端与客户端、本地客户端与远程客户端的代码相同。虽然服务端与客户端会运行不同的代码，在开发时只用开发一次，把客户端和服务端的代码都写在一起，对于差异运行的代码，使用特性标注是由服务器运行还是客户端运行即可（如`[Server]`方法特性和`[Client]`方法特性）。

### 在联机游戏中玩家不是真正的在同一个世界？

很遗憾，是的。在多人联机中，物理上玩家与玩家之间并没有处在同一个游戏世界，每个玩家都身处于自己客户端渲染的世界。之所以有在同一个世界的错觉，是因为客户端渲染了`同步数据`。

换句话说，只要让每个客户端每时每刻都渲染相同的数据，那么就能让玩家们产生在同一个世界的错觉。

### 如何同步数据？

通过数据传输协议，客户端或服务端对数据进行发送和接收。比如现在Mirror默认数据传输协议为kcp2k，一个延迟小但占用带宽大的协议。可以根据开发需求切换不同的协议。

Mirror已经把底层的数据同步工作封装好了，我们只用调用其API就行了。

### 什么是客户端/服务端模式？

客户端/服务端(CS)模式指以服务端（服务器）为关键数据源，接收处理各个客户端的数据和将数据分发给所有客户端的模式。所有数据都经过了服务器的验证和过滤，只有合法的请求和数据才能被发送。

比如，移动、射击、死亡、爆炸等重要方法，应在服务端中调用，再通过Mirror封装的数据传输分发到各个客户端中。

换个角度，可以看成服务器运行了一个游戏本体，其他连接上的客户端分别运行独立的副本，通过数据传输协议让本体和所有副本保持数据同步。有了同步的数据，各个客户端就能渲染出相同的结果。

Mirror支持让主机作为服务端时同时运行一个客户端，也可以在某个云服务器上部署无头的专门服务端供所有玩家链接。

### 什么是客户端/客户端模式？

客户端/客户端(CC)模式指每个客户端都可以作为关键数据源，每个客户端的数据变化通过一个中心化的云服务器(租赁)直接广播给其他客户端。

与CS模式的区别在于，CC模式中的服务器只做数据传输、广播所用，并不单独运行一个游戏本体或副本。

Mirror并不支持这种模式。

### 哪种模式更好？

各有优点和缺点。

CS模式最大的优点是可以防止客户端作弊。

由于以服务器独立运行的游戏本体为标准，逻辑上来说可以显著避免被黑客、外挂所影响，除非直接替换掉在服务器中运行游戏的代码。

黑客、外挂基本只能作用于客户端，对客户端进行修改很难影响到服务端，因为服务端中运行的游戏无法接受不存在的方法调用。有这么一层逻辑在，开发者还能通过一些参数验证阻止不寻常参数传入。

比如在吃鸡游戏中，外挂可以修改奔跑参数，而在CS模式中，人物的移动命令实际发生在服务端。也就是说，可以在移动方法中插入参数验证，或者直接使用服务端中的移动参数。

最大的缺点就是P2P所有的缺点CS模式全部继承，如果主机掉线全部玩儿完。

CC模式的优缺点基本跟CS模式是反着来的。所以应该由游戏类型和需求来决定用什么模式。

虽然Mirror不支持CC模式，但可以尝试[Photon](https://www.photonengine.com/)。

### 服务器Server和主机host的区别是什么？

